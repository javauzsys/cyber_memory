<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Memory: Pro Edition ðŸ—¿</title>
    <style>
        :root { --neon: #00f2ff; --bg: #050505; --danger: #ff003c; --gold: #f1c40f; }
        body { background-color: var(--bg); color: white; font-family: 'Orbitron', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; overflow-x: hidden; user-select: none; }
        
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        .header { text-align: center; margin-top: 20px; width: 100%; position: relative; z-index: 10; }
        h1 { color: var(--neon); text-shadow: 0 0 15px var(--neon); margin: 5px 0; font-size: 2.2rem; }
        
        .status-bar { display: flex; justify-content: center; gap: 30px; font-size: 1.1rem; background: rgba(255,255,255,0.05); padding: 15px; border-bottom: 2px solid var(--neon); width: 100%; box-sizing: border-box; backdrop-filter: blur(5px); }
        .val { color: var(--neon); font-weight: bold; transition: color 0.3s; }
        
        /* Vaqt oz qolganda animatsiya */
        .danger-mode { color: var(--danger) !important; text-shadow: 0 0 20px var(--danger); animation: pulse-red 0.5s infinite alternate; font-size: 1.3rem; }
        @keyframes pulse-red { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0.6; transform: scale(1.1); } }

        /* Noto'g'ri bo'lganda titrash (Shake) */
        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translateX(0) rotateY(180deg); }
            20%, 60% { transform: translateX(-10px) rotateY(180deg); }
            40%, 80% { transform: translateX(10px) rotateY(180deg); }
        }

        .game-container { display: grid; gap: 10px; perspective: 1000px; padding: 20px; margin-top: 10px; z-index: 5; }

        .card { width: 75px; height: 100px; position: relative; transform-style: preserve-3d; transition: transform 0.5s; cursor: pointer; }
        .card.flipped { transform: rotateY(180deg); }

        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; font-size: 2rem; border-radius: 8px; border: 2px solid var(--neon); background: #111; }
        .card-front { color: var(--neon); box-shadow: inset 0 0 10px var(--neon); }
        .card-back { background: var(--neon); color: #000; transform: rotateY(180deg); box-shadow: 0 0 20px var(--neon); }
        
        .matched { transform: scale(0); opacity: 0; pointer-events: none; transition: 0.6s; }
        
        .particle { position: absolute; width: 8px; height: 8px; border-radius: 50%; pointer-events: none; z-index: 999; }

        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; }
        button { background: transparent; border: 2px solid var(--neon); color: var(--neon); padding: 15px 40px; font-size: 1.5rem; cursor: pointer; transition: 0.3s; margin-top: 30px; font-family: 'Orbitron'; text-transform: uppercase; }
        button:hover { background: var(--neon); color: black; box-shadow: 0 0 30px var(--neon); }
    </style>
</head>
<body>

    <div class="header">
        <h1>LEVEL <span id="level-display">1</span></h1>
        <div class="status-bar">
            <div>VAQT: <span id="timer" class="val">30</span></div>
            <div>URINISH: <span id="moves" class="val">0</span></div>
            <div>BEST: <span id="best-level" class="val">0</span></div>
        </div>
    </div>

    <div class="game-container" id="grid"></div>

    <div id="overlay">
        <h2 id="msg-text" style="font-size: 3rem; margin: 0;"></h2>
        <button onclick="startNextLevel()" id="next-btn">DAVOM ETTIRISH</button>
    </div>

    <script>
        // --- AUDIO ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let bgInterval = null;
        let noteIndex = 0;

        function playSound(freq, type, duration, vol = 0.1) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playWarningBeep() { playSound(1200, 'square', 0.1, 0.03); }

        function startBackgroundMusic() {
            if (bgInterval) return;
            const melody = [261.63, 329.63, 392.00, 440.00, 392.00, 329.63]; 
            bgInterval = setInterval(() => {
                if(audioCtx.state === 'running') {
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(melody[noteIndex], audioCtx.currentTime);
                    osc.connect(gain); gain.connect(audioCtx.destination);
                    gain.gain.setValueAtTime(0.02, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.15);
                    osc.start(); osc.stop(audioCtx.currentTime + 0.2);
                    noteIndex = (noteIndex + 1) % melody.length;
                }
            }, 300);
        }

        const sounds = {
            flip: () => playSound(600, 'triangle', 0.05),
            match: () => { playSound(523.25, 'square', 0.1); setTimeout(() => playSound(659.25, 'square', 0.1), 100); },
            wrong: () => playSound(100, 'sawtooth', 0.4, 0.2),
            win: () => { 
                playSound(523.25, 'square', 0.1); setTimeout(() => playSound(659.25, 'square', 0.1), 150); 
                setTimeout(() => playSound(783.99, 'square', 0.2), 300); setTimeout(() => playSound(1046.50, 'square', 0.4), 450); 
            }
        };

        function createParticles(x, y) {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                document.body.appendChild(particle);
                const rect = document.body.getBoundingClientRect();
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 120 + 60;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                const colors = ['#00f2ff', '#ff003c', '#f1c40f', '#00ff00'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
                ], { duration: 800, easing: 'cubic-bezier(0, .9, .57, 1)' }).onfinish = () => particle.remove();
            }
        }

        // --- GAME ENGINE ---
        const allIcons = ['ðŸ—¿', 'ðŸ‘½', 'ðŸš€', 'ðŸ”®', 'ðŸ’Ž', 'ðŸ”¥', 'âš¡', 'ðŸ¤–', 'ðŸŽ®', 'ðŸ›¸', 'ðŸŽƒ', 'ðŸ‘¾', 'ðŸŒ€', 'ðŸŒˆ', 'â­', 'ðŸ€', 'ðŸŽ', 'ðŸ±', 'ðŸ•', 'ðŸŒ'];
        let currentLevel = 1, moves = 0, timeLeft = 30, timerInterval;
        let firstCard, secondCard, lockBoard = false, matchedPairs = 0;

        document.getElementById('best-level').innerText = localStorage.getItem('cyberBest') || 0;

        function initGame() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            matchedPairs = 0; moves = 0;
            document.getElementById('moves').innerText = moves;
            document.getElementById('level-display').innerText = currentLevel;
            document.getElementById('timer').classList.remove('danger-mode');
            let pairCount = 2 + currentLevel;
            if (pairCount > 20) pairCount = 20;
            timeLeft = 15 + (pairCount * 4);
            document.getElementById('timer').innerText = timeLeft;
            const selectedIcons = allIcons.slice(0, pairCount);
            const gameGrid = [...selectedIcons, ...selectedIcons].sort(() => 0.5 - Math.random());
            let cols = currentLevel < 3 ? 3 : (currentLevel < 6 ? 4 : 5);
            grid.style.gridTemplateColumns = `repeat(${cols}, 75px)`;
            gameGrid.forEach(icon => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.icon = icon;
                card.innerHTML = `<div class="card-face card-front">?</div><div class="card-face card-back">${icon}</div>`;
                card.addEventListener('click', flipCard);
                grid.appendChild(card);
            });
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                const timerElement = document.getElementById('timer');
                timerElement.innerText = timeLeft;
                if (timeLeft <= 10 && timeLeft > 0) {
                    timerElement.classList.add('danger-mode');
                    playWarningBeep(); 
                }
                if (timeLeft <= 0) gameOver(false);
            }, 1000);
        }

        function flipCard() {
            if (lockBoard || this === firstCard || this.classList.contains('flipped')) return;
            if (audioCtx.state === 'suspended') { audioCtx.resume(); startBackgroundMusic(); }
            
            sounds.flip();
            this.classList.add('flipped');

            if (!firstCard) {
                firstCard = this;
                return;
            }

            secondCard = this;
            moves++;
            document.getElementById('moves').innerText = moves;
            checkMatch(); 
        }

        function checkMatch() {
            lockBoard = true;
            const isMatch = firstCard.dataset.icon === secondCard.dataset.icon;

            if (isMatch) {
                setTimeout(() => {
                    matchedPairs++; 
                    sounds.match();
                    const rect = secondCard.getBoundingClientRect();
                    createParticles(rect.left + 37, rect.top + 50);
                    firstCard.classList.add('matched');
                    secondCard.classList.add('matched');
                    resetBoard();
                    if (matchedPairs === document.querySelectorAll('.card').length / 2) gameOver(true);
                }, 600);
            } else {
                // SIZ AYTGAN MANTIQ: 
                // 1. 2 soniya davomida ochiq holda ko'rsatadi
                setTimeout(() => {
                    // 2. So'ngra vibratsiya/titrash beradi
                    firstCard.classList.add('shake');
                    secondCard.classList.add('shake');
                    sounds.wrong();

                    // 3. Titrash tugagach yopiladi
                    setTimeout(() => {
                        firstCard.classList.remove('shake');
                        secondCard.classList.remove('shake');
                        firstCard.classList.remove('flipped');
                        secondCard.classList.remove('flipped');
                        resetBoard();
                    }, 500);
                }, 300); 
            }
        }

        function resetBoard() { [firstCard, secondCard] = [null, null]; lockBoard = false; }

        function gameOver(isWin) {
            clearInterval(timerInterval);
            const overlay = document.getElementById('overlay');
            overlay.style.display = 'flex';
            if (isWin) {
                sounds.win();
                document.getElementById('msg-text').innerText = "AJOYIB! ðŸŽ‰";
                document.getElementById('next-btn').innerText = "KEYINGI BOSQICH";
                document.getElementById('next-btn').onclick = startNextLevel;
                let best = parseInt(localStorage.getItem('cyberBest')) || 0;
                if (currentLevel > best) {
                    localStorage.setItem('cyberBest', currentLevel);
                    document.getElementById('best-level').innerText = currentLevel;
                }
            } else {
                document.getElementById('msg-text').innerText = "VAQT TUGADI!";
                document.getElementById('next-btn').innerText = "QAYTADAN BOSHLASH";
                document.getElementById('next-btn').onclick = () => { currentLevel = 1; overlay.style.display = 'none'; initGame(); };
            }
        }

        function startNextLevel() {
            currentLevel++;
            document.getElementById('overlay').style.display = 'none';
            initGame();
        }

        document.body.addEventListener('click', () => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            startBackgroundMusic();
        }, {once: true});

        initGame();
    </script>
</body>
</html>